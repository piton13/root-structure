<!DOCTYPE html>
<html>
<head>
    <style>
        .stats {
          margin-top: 10px;
          margin-bottom: 10px;
        }
    </style>
</head>
<body>
<div id="list">
    <div>Please choose init folder for source folder</div>
</div>

</body>
<script src="https://cdn.socket.io/3.1.3/socket.io.min.js" integrity="sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh" crossorigin="anonymous"></script>
<script>
  const socket = io("http://localhost:4567");

  function moveToFolder(path) {
    if (path) {
      socket.emit('private_message', { path });
    }
  }

  function buildTree(msg) {
    const listEl = document.getElementById('list');
    const records = msg.data;
    const { count, size } = msg.stats;
    const moveBack = `<div onclick="moveToFolder('..')">..</div>`;
    const list = records
      .sort((a, b) => Number(b.size) - Number(a.size))
      .map(i => {
        const path = `${i.fileName}`;

        return `
        <div onclick="moveToFolder('${i.isFile ? '' : path}')">Modified at ${i.time}; Size: ${i.size}; ${i.fileName}</div>
        `;
      })
      .join('<br>');
    const stats = `<div class="stats">General size of ${count} files is: ${size} bytes</div>`;

    listEl.innerHTML = `${/source\/*/.test(records[0].fileName) ? moveBack : ''}${list}${stats}`;
  }
  // from the same domain
  // from different one
  socket.on("connect", () => {
    console.log(`Socket ${socket.id} on client: `); // x8WIv7-mJelg7on_ALbx
  });

  socket.on("disconnect", () => {
    console.log('Disconnected from socket', socket.id); // undefined
  });

  socket.on("initialization", (msg) => {
    console.log('Initialization started');

    const listEl = document.getElementById('list');
    listEl.innerHTML = `
        <div class="stats">Please choose source folder</div>
        ${msg.rootFolders.map(f => `<div onclick="moveToFolder('${f}')">${f}</div>`).join('')}
    `;
  });

  socket.on("data", (msg) => {
    console.log('Data obrained', msg)
  });

  socket.on("private_msg", (msg) => {
    console.log('private_msg from server: ', msg);

    buildTree(msg);
  });

  // send to socket

  // get from socket
</script>
</html>
