<!DOCTYPE html>
<html>
<head>
    <style>
        .stats {
          margin-top: 10px;
        }
    </style>
</head>
<body>
<div id="list">List is empty</div>
<button id="a_button">send message to socket</button>

</body>
<script src="https://cdn.socket.io/3.1.3/socket.io.min.js" integrity="sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh" crossorigin="anonymous"></script>
<script>
  const socket = io("http://localhost:4567");
  const rootPath = 'source';
  let currentPath = '';

  function abc() {
    socket.emit('private_message', { path: rootPath });
  }

  function moveToFolder(path) {
    console.log('path: ', path);
    if (path) {
      currentPath = path;
      socket.emit('private_message', { path: `${rootPath}/${currentPath}` });
    }
  }

  function buildTree(msg) {
    const listEl = document.getElementById('list');
    const records = msg.data;
    const { count, size } = msg.stats;
    const list = records
      .sort((a, b) => Number(b.size) - Number(a.size))
      .map(i => {
        const path = `${currentPath}/${i.fileName}`;
        const isFile = /^\w*\.\w*$/.test(path);

        return `
        <div onclick="moveToFolder('${isFile ? '' : path}')"> ${path} ${i.size} ${i.time}</div>
        `;
      })
      .join('<br>');
    const stats = `<div class="stats">General size of ${count} files is: ${size} bytes</div>`;

    listEl.innerHTML = `${list}${stats}`;
  }
  // from the same domen
  // const socket = io();
  // from different one
  socket.on("connect", () => {
    console.log(`Socket ${socket.id} on client: `); // x8WIv7-mJelg7on_ALbx
  });

  socket.on("disconnect", () => {
    console.log('Disconnected from socket', socket.id); // undefined
  });

  socket.on("data", (msg) => {
    console.log('Data obrained', msg)
  });

  socket.on("private_msg", (msg) => {
    console.log('private_msg from server: ', msg);

    buildTree(msg);
  });

  const button = document.getElementById('a_button');
  button.addEventListener('click', abc);

  // send to socket

  // get from socket
</script>
</html>
